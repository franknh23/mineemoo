var vZeroPayPalButton=Class.create();vZeroPayPalButton.prototype={initialize:function(clientToken,storeFrontName,singleUse,locale,futureSingleUse,onlyVaultOnVault,clientTokenUrl,additionalOptions){this.clientToken=clientToken||!1,this.clientTokenUrl=clientTokenUrl,this.storeFrontName=storeFrontName,this.singleUse=singleUse,this.locale=locale,this.additionalOptions=additionalOptions,this.amount=0,this.currency=!1,this.client=!1,this.onlyVaultOnVault=onlyVaultOnVault||!1},getClientToken:function(callbackFn){return!1!==this.clientToken?callbackFn(this.clientToken):window.braintreeClientToken?callbackFn(window.braintreeClientToken):void new Ajax.Request(this.clientTokenUrl,{method:"get",onSuccess:function(transport){if(transport&&(transport.responseJSON||transport.responseText)){var response=this._parseTransportAsJson(transport);if(1==response.success&&"string"==typeof response.client_token)return this.clientToken=response.client_token,window.braintreeClientToken=response.client_token,callbackFn(this.clientToken);console.error("We were unable to retrieve a client token from the server to initialize the Braintree flow."),response.error&&console.error(response.error)}}.bind(this),onFailure:function(){console.error("We were unable to retrieve a client token from the server to initialize the Braintree flow.")}.bind(this)})},getClient:function(callbackFn){!1!==this.client?"function"==typeof callbackFn&&callbackFn(this.client):this.getClientToken(function(clientToken){braintree.client.create({authorization:clientToken},function(clientErr,clientInstance){clientErr?console.log(clientErr):(this.client=clientInstance,callbackFn(this.client))}.bind(this))})},setPricing:function(amount,currency){this.amount=parseFloat(amount),this.currency=currency},rebuildButton:function(){return!1},addPayPalButton:function(options,containerQuery){var container;if(!(container="string"==typeof(containerQuery=containerQuery||"#paypal-container")?$$(containerQuery):containerQuery))return console.warn("Unable to locate container "+containerQuery+" for PayPal button."),!1;this.attachPayPalButtonEvent(container,options)},attachPayPalButtonEvent:function(buttons,options){this.getClient(function(clientInstance){braintree.paypalCheckout.create({client:clientInstance},function(paypalCheckoutErr,paypalCheckoutInstance){if(paypalCheckoutErr)console.error("Error creating PayPal Checkout:",paypalCheckoutErr);else for(var id,i=0;i<buttons.length;++i){id="paypal_button_"+this.getRandomQS(),buttons[i].id=id,buttons[i].className+=" paypalbtn-rendered";var params={env:options.env,commit:options.commit,style:options.style,funding:{allowed:[],disallowed:[]},payment:function(){if("function"!=typeof options.events.validate||!1!==options.events.validate())return paypalCheckoutInstance.createPayment(options.payment)},onAuthorize:function(data,actions){return paypalCheckoutInstance.tokenizePayment(data).then(options.events.onAuthorize)},onCancel:function(){"function"==typeof options.events.onCancel&&options.events.onCancel()},onError:function(err){"function"==typeof options.events.onError&&options.events.onError()}};0<=options.funding.allowed.indexOf("credit")?params.funding.allowed.push(paypal.FUNDING.CREDIT):0<=options.funding.disallowed.indexOf("credit")&&params.funding.disallowed.push(paypal.FUNDING.CREDIT),0<=options.funding.allowed.indexOf("card")?params.funding.allowed.push(paypal.FUNDING.CARD):0<=options.funding.disallowed.indexOf("card")&&params.funding.disallowed.push(paypal.FUNDING.CARD),0<=options.funding.allowed.indexOf("elv")?params.funding.allowed.push(paypal.FUNDING.ELV):0<=options.funding.disallowed.indexOf("elv")&&params.funding.disallowed.push(paypal.FUNDING.ELV),buttons[i].getAttribute("data-style-layout")&&(params.style.layout=buttons[i].getAttribute("data-style-layout")),buttons[i].getAttribute("data-style-size")&&(params.style.size=buttons[i].getAttribute("data-style-size")),buttons[i].getAttribute("data-style-shape")&&(params.style.shape=buttons[i].getAttribute("data-style-shape")),buttons[i].getAttribute("data-style-color")&&(params.style.color=buttons[i].getAttribute("data-style-color")),paypal.Button.render(Object.assign({},params),"#"+id)}}.bind(this))}.bind(this))},_buildOptions:function(){var funding=this.additionalOptions.funding;return{env:this.additionalOptions.env,commit:!0,style:this.additionalOptions.buttonStyle,payment:{flow:this._getFlow(),amount:this.amount,currency:this.currency,enableShippingAddress:!1,shippingAddressEditable:!1,displayName:this.storeFrontName},funding:funding}},_getFlow:function(){var flow;return flow=!0===this.singleUse?"checkout":"vault",null!==$("gene_braintree_paypal_store_in_vault")&&this.onlyVaultOnVault&&"vault"==flow&&!$("gene_braintree_paypal_store_in_vault").checked&&(flow="checkout"),flow},_parseTransportAsJson:function(transport){return transport.responseJSON&&"object"==typeof transport.responseJSON?transport.responseJSON:transport.responseText?"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(transport.responseText):eval("("+transport.responseText+")"):{}},getRandomQS:function(){var num=999998*Math.random()+1;return Math.floor(num)}};
