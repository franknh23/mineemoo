var BraintreeExpressAbstract=Class.create();BraintreeExpressAbstract.prototype={initialize:function(clientToken,storeFrontName,formKey,source,urls,config){this.clientToken=clientToken||!1,this.storeFrontName=storeFrontName,this.formKey=formKey,this.source=source,this.urls=urls,this.config=config||{},this._init(),this.insertDom()},_init:function(){return!1},insertDom:function(){this.getModal()||$$("body").first().insert('<div id="pp-express-overlay"></div><div id="pp-express-modal"></div><div id="pp-express-container"></div>')},getOverlay:function(){return document.getElementById("pp-express-overlay")},getModal:function(){return document.getElementById("pp-express-modal")},hideModal:function(){this.getOverlay().style.display="none",this.getModal().style.display="none",this.getModal().innerHTML=""},showModal:function(){this.getModal().innerHTML="",this.getModal().classList.add("loading"),this.getOverlay().style.display="block",this.getModal().style.display="block"},initModal:function(params){void 0===params.form_key&&(params.form_key=this.formKey),void 0===params.source&&(params.source=this.source),this.showModal(),new Ajax.Request(this.urls.authUrl,{method:"POST",parameters:params,onSuccess:function(data){this.getModal().classList.remove("loading"),this.getModal().innerHTML=data.responseText,this.prepareCoupon(),this.ajaxHandler()}.bind(this),onFailure:function(){this.hideModal(),alert("object"==typeof Translator?Translator.translate("We were unable to complete the request. Please try again."):"We were unable to complete the request. Please try again.")}.bind(this)})},updateShipping:function(method){this._setLoading($("paypal-express-submit")),new Ajax.Request(this.urls.shippingSaveUrl,{method:"POST",parameters:{submit_shipping:!0,shipping_method:method},onSuccess:function(data){var response=this._getJson(data);this._unsetLoading($("paypal-express-submit")),this._updateTotals(response)}.bind(this),onFailure:function(){this._unsetLoading($("paypal-express-submit")),api.hideModal(),alert("object"==typeof Translator?Translator.translate("We were unable to complete the request. Please try again."):"We were unable to complete the request. Please try again.")}})},prepareCoupon:function(){$("paypal-express-coupon")&&$("paypal-express-coupon").observe("keypress",function(event){(event.which||event.keyCode)==Event.KEY_RETURN&&(Event.stop(event),this.updateCoupon())}.bind(this))},updateCoupon:function(coupon){return $("paypal-express-coupon-error").hide(),!coupon&&$("paypal-express-coupon")&&(coupon=$("paypal-express-coupon").value),""==coupon||(this._setLoading($("paypal-express-coupon-apply")),new Ajax.Request(this.urls.couponSaveUrl,{method:"POST",parameters:{coupon:coupon},onSuccess:function(data){var response=this._getJson(data);this._unsetLoading($("paypal-express-coupon-apply")),this._updateTotals(response),1==response.success?($("paypal-express-coupon-remove").show(),$("paypal-express-coupon-apply").hide()):response.message&&$("paypal-express-coupon-error").update(response.message).show()}.bind(this),onFailure:function(){this._unsetLoading($("paypal-express-coupon-submit")),api.hideModal(),alert("object"==typeof Translator?Translator.translate("We were unable to complete the request. Please try again."):"We were unable to complete the request. Please try again.")}})),!1},removeCoupon:function(){$("paypal-express-coupon-error").hide(),this._setLoading($("paypal-express-coupon-remove")),new Ajax.Request(this.urls.couponSaveUrl,{method:"POST",parameters:{remove:!0},onSuccess:function(data){var response=this._getJson(data);this._unsetLoading($("paypal-express-coupon-remove")),this._updateTotals(response),1==response.success?($("paypal-express-coupon-remove").hide(),$("paypal-express-coupon-apply").show(),$("paypal-express-coupon").value="",$("paypal-express-coupon").focus()):response.message&&$("paypal-express-coupon-error").update(response.message).show()}.bind(this),onFailure:function(){this._unsetLoading($("paypal-express-coupon-submit")),api.hideModal(),alert("object"==typeof Translator?Translator.translate("We were unable to complete the request. Please try again."):"We were unable to complete the request. Please try again.")}})},_updateTotals:function(response){void 0!==response.totals&&$("paypal-express-totals").update(response.totals)},_getJson:function(data){return void 0!==data.responseJSON?data.responseJSON:"string"==typeof data.responseText?data.responseText.evalJSON():void 0},_setLoading:function(element){if(!element)return!1;element.setAttribute("disabled","disabled"),element.addClassName("loading")},_unsetLoading:function(element){if(!element)return!1;element.removeAttribute("disabled"),element.removeClassName("loading")},ajaxHandler:function(){var form=document.getElementById("gene_braintree_paypal_express_pp");Element.observe(form,"submit",function(e){Event.stop(e);var formParams=$("gene_braintree_paypal_express_pp").serialize(!0);return this.getModal().classList.add("loading"),this.getModal().innerHTML="",new Ajax.Request(e.target.getAttribute("action"),{method:"POST",parameters:formParams,onSuccess:function(data){"complete"!=data.responseText?(this.getModal().classList.remove("loading"),this.getModal().innerHTML=data.responseText,this.ajaxHandler()):document.location=this.urls.successUrl}.bind(this),onFailure:function(){this.hideModal(),alert("object"==typeof Translator?Translator.translate("We were unable to complete the request. Please try again."):"We were unable to complete the request. Please try again.")}.bind(this)}),!1}.bind(this))},validateForm:function(){if("object"==typeof productAddToCartForm&&productAddToCartForm.validator.validate()){if("object"==typeof productAddToCartFormOld&&productAddToCartFormOld.validator.validate())return!0;if("object"!=typeof productAddToCartFormOld)return!0}return"object"!=typeof productAddToCartForm&&"object"!=typeof productAddToCartFormOld},attachToButtons:function(buttons){console.warn("This method cannot be called directly.")}};
